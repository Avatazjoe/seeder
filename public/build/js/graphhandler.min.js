/*
 Seeder 2014-04-30 
*/
function ID(){return"_"+Math.random().toString(36).substr(2,9)}function getSaveState(a,b,c,d){var e=JSON.parse($.cookie("seederuser")),f=new Object;f.datecreated=+new Date,f.likes=0,f.dislikes=0,f.views=0,f.nsize=nodelength,f.esize=edgelength;var g=jQuery.extend(!0,{},a);for(key in g)g[key].nodes.forEach(function(a){delete a.nodedata.imagedata});var h=new Object;return h.graphid=ID(),h.publish=d,h.author=e.id,h.graphname=b,h.graphdesc=c,h.graph=g,h.graphmeta=f,h}var sys,waiting_save_confirm=!1,waiting_publish_confirm=!1,nodelength=0,edgelength=0;$(document).ready(function(){function a(a){r=a.node.data,$("#field_edit_node_name").val(a.node.data.name),$("#field_edit_node_text").val(a.node.data.text),$("#field_edit_node_link").val(a.node.data.link),$("#field_edit_node_size").val(a.node.data.size),$("#picker_edit_edgecolor").val(a.node.data.color)}function b(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.round(15*Math.random())];return b}function c(){$("#btn_publishgraph").hasClass("positive")?($("#btn_publishgraph").removeClass("positive"),$("#btn_savegraph").addClass("positive")):($("#btn_publishgraph").addClass("positive"),$("#btn_savegraph").removeClass("positive"))}function d(a){var b="";for(property in a.graph)b+=property+": "+a.graph[property]+"; ";m.emit("USER_SAVEGRAPH",{payload:a}),a.publish?waiting_publish_confirm=!0:waiting_save_confirm=!0}function e(a){y=a,a+="z",x[a]&&(sys.prune(function(){return!0}),x[a].nodes.forEach(function(a){sys.addNode(a.nodename,a.nodedata)}),x[a].edges.forEach(function(a){sys.addEdge(a.fromnode,a.tonode)}))}function f(a,b){layername=a+"z",x[layername]=new Object,x[layername].layername=a,x[layername].parentlayer=b,x[layername].nodes=new Array,x[layername].edges=new Array}function g(a,b,c){c+="z",x[c].nodes.forEach(function(d,e){return d.nodename==a?(x[c].nodes[e].nodedata=b,!1):void 0})}function h(a,b,c){nodelength+=1,c+="z","LAYER"==b.TYPE&&(f(b.nodeid,y),b.parentlayer=y,x[b.nodeid+"z"].nodes.push({nodename:b.nodeid,nodedata:b})),sys.addNode(b.nodeid,b),x[c].nodes.push({nodename:b.nodeid,nodedata:b})}function i(a,b,c){edgelength+=1,c+="z",sys.addEdge(a,b),x[c].edges.push({fromnode:a,tonode:b})}function j(){if(null!=r||void 0!=r){var a=new Object;return a.name=$("#field_edit_node_name").val(),a.text=$("#field_edit_node_text").val(),a.link=$("#field_edit_node_link").val(),a.size=$("#field_edit_node_size").val(),a.id=b(),a.color=$("#picker_edit_edgecolor").val(),a.TYPE=r.TYPE,""==a.name?($("#field_edit_node_name").addClass("errorform"),-1):($("#field_edit_node_name").removeClass("errorform"),a)}}function k(){var a=new Object;return a.name=$("#field_node_name").val(),a.text=$("#field_node_text").val(),a.link=$("#field_node_link").val(),a.size=$("#field_node_size").val(),a.id=b(),a.color=$("#picker_edgecolor").val(),a.TYPE=$("#select_node_type").val(),""==a.name?($("#field_node_name").addClass("errorform"),-1):($("#field_node_name").removeClass("errorform"),a)}var l="54.201.24.162",m=io.connect(l+":80"),n=!1,o=!1,p=new Array;$("#tabs").tabs(),$("input[type=submit]").button(),$("#pallete").draggable({containment:"parent"}),$("#graph_tab").height($("body").height()),$("#text_tab").height(0),$("#tabs-1").show(),$("#tabs-2").hide(),$("#tabs-3").hide(),$("#tabs-4").hide(),$("#updatelabel").hide();var q=$(".ui.sidebar");q.sidebar("toggle"),q.sidebar("attach events","#sidebar-toggle","toggle");var r,s=!1,t=$("#menu").width(),u=$("#nav").height(),v=new Object,w=new Object,x=new Object,y="-1";f("-1","0"),v.name="Start",v.text="lorem ipsum",v.link="http://www.google.com/",v.TYPE="TEXT",v.size=30,v.nodeid=-1,v.color="#564F8A",sys=arbor.ParticleSystem(0,500,1),sys.parameters({gravity:!0,friction:1,repulsion:0}),sys.renderer=Renderer("#graph_canvas"),h("-1",v,y);var z,A,B=0,C=new Object;C.w=300,C.h=70,C.title="Welcome!",C.subtext="begin by adding some nodes",note("#contain_main",C),$("body").mousemove(function(a){var b={x:a.pageX-270,y:a.pageY-50};if(z=sys.nearest(b),z&&"ARTICLE"==z.node.data.TYPE&&(z.node.data.NEAREST=!0,$("#node-title").text(z.node.data.TITLE),$("#node-domain").text(z.node.data.DOMAIN),$("#node-description").text(z.node.data.DESCRIPTION),$("#node-image").attr("src",z.node.data.IMAGE),$("#node-link").attr("href",z.node.data.URL)),n){var c=$("#field_node_size").val(),d=$("#picker_edgecolor").val();""==c||""==d?$("#node-dropper").css("top",a.pageY-u+"px").css("left",a.pageX+t+"px"):($("#node-dropper").css("top",a.pageY-u+"px").css("left",a.pageX+t+"px"),$("#node-dropper").css("background-color",d),$("#node-dropper").css("width",2*c+"px"),$("#node-dropper").css("height",2*c+"px"),$("#node-dropper").css("border-radius",c+"px"))}}),$("#graph_canvas").click(function(b){sys.start();var c=sys.nearest({x:b.offsetX,y:b.offsetY});if(n){var d=jQuery.extend(!0,{},v);d.nodeid=++B+"";var e=!1;if(sys.eachNode(function(a){a.data.name==v.name&&(e=!0)}),e)alert('node name already exists, you can edit nodes by clicking "edit nodes"');else if(null!=c){h(d.nodeid,d,y),i(c.node.data.nodeid,d.nodeid,y);var f=new Object;f.w=300,f.h=70,f.title="Node Added!",f.subtext="node named "+d.name+" added.",note("#contain_main",f),B++}else{h(d.nodeid,d,y);var f=new Object;f.w=300,f.h=70,f.title="Node Added!",f.subtext="node named "+d.name+" added.",note("#contain_main",f)}$("#node-dropper").remove(),$("#btn_addnode").removeClass("red").addClass("green"),$("#btn_addnode").val("Add Node"),n=!1;var g=0;return sys.eachNode(function(){g++}),void(g>=1&&sys.parameters({gravity:!0,friction:.1,repulsion:0,stiffness:500}))}return o?((0==p.length||1==p.length)&&(p.push(c),1==p.length&&$("#edgesource").text(p[0].node.data.name)),void(2==p.length&&($("#edgedestination").text(p[1].node.data.name),$("#btn_addedge").removeClass("red").addClass("green"),$("#btn_addedge").val("Add Edge"),i(p[0].node.data.nodeid,p[1].node.data.nodeid,y),o=!1,p=new Array))):$("#tabs-3").is(":visible")?($("#form_editnode").show(),$("#edit_notice").hide(),void a(c)):void 0}),$("#graph_canvas").dblclick(function(a){var b=sys.nearest({x:a.offsetX,y:a.offsetY});b.distance<20&&"LAYER"==b.node.data.TYPE&&e(b.node.data.nodeid==y?x[y+"z"].parentlayer:b.node.data.nodeid)}),$("#editnode_tab_button").click(function(){$("#edit_notice").show()}),$(window).scroll(function(a){n&&a.preventDefault()}),$("body").mousedown(function(a){if(-1!=a.target.className.indexOf("search_result")||-1!=a.target.parentElement.className.indexOf("search_result")){s=!0,$("#search_results_holder").css("overflow-x","hidden"),$("search_results_holder").addClass("stop-scroll");var b=new Object;"search_result"==a.target.className?(b.URL=a.srcElement.attributes.URL.nodeValue,b.DESCRIPTION=a.srcElement.attributes.DESCRIPTION.nodeValue,b.TITLE=a.srcElement.attributes.TITLE.nodeValue,b.IMAGE=a.srcElement.attributes.IMAGE.nodeValue,b.TYPE=a.srcElement.attributes.TYPE.nodeValue,b.DOMAIN=a.srcElement.attributes.DOMAIN.nodeValue,b.NEAREST=!1):(b.URL=a.srcElement.parentElement.attributes.URL.nodeValue,b.DESCRIPTION=a.srcElement.parentElement.attributes.DESCRIPTION.nodeValue,b.TITLE=a.srcElement.parentElement.attributes.TITLE.nodeValue,b.IMAGE=a.srcElement.parentElement.attributes.IMAGE.nodeValue,b.TYPE=a.srcElement.parentElement.attributes.TYPE.nodeValue,b.DOMAIN=a.srcElement.parentElement.attributes.DOMAIN.nodeValue,b.NEAREST=!1);var c=new Object;c.w=300,c.h=70,c.title="Adding Article!",c.subtext="release near destination to add",note("#contain_main",c),A=b}}),$("body").mouseup(function(a){if($("body").removeClass("unselectable"),$("search_results_holder").removeClass("stop-scrolling"),s){$("#search_results_holder").css("overflow-x","scroll");var b=new Image;b.src=A.IMAGE,A.imagedata=b,s=!1;var c=0,d=sys.nearest({x:a.pageX-270,y:a.pageY-50});d?(A.nodeid=B+"",h(B+"",A,y),i(d.node.data.nodeid,B+"",y)):h(B+"",A,y),sys.eachNode(function(){c++});var e=new Object;e.w=300,e.h=70,e.title="Added Article!",e.subtext="Article bound to node "+d.node.data.name,note("#contain_main",e),B++}m.on("hs_id",function(a){m.id=a.data}),m.on("request_pullGraph_success",function(a){rebuildPullGraph(a.data)}),m.on("SAVE_SUCCESS",function(){if(waiting_save_confirm){waiting_save_confirm=!1,$("#savepanel").css("height",$("#updatelabel").height()+10+"px");var a=new Date;$("#lastsave").text(" "+a),$("#updatelabel").show()}}),m.on("PUBLISH_SUCCESS",function(){if(waiting_publish_confirm){waiting_publish_confirm=!1,$("#savepanel").css("height",$("#updatelabel").height()+10+"px"),$("#savepanel").css("background-color","#ffffff");var a=new Date;$("#lastsave").text(" "+a),$("#updatelabel").show()}})}),$("#btn_publishgraph").click(function(){$("#search_results_holder").height(0),$("#savepanel").css("height","150px"),$("#savepanel").css("background-color","#564F8A");var a=$("#sp_graphname").val(),b=$("#sp_graphdesc").val();$("#sp_graphname").val(""),$("#sp_graphdesc").val(""),""!=a&&""!=b&&d(getSaveState(x,a,b,1))}),$("#btn_savegraph").click(function(){$("#search_results_holder").height(0),$("#savepanel").css("height","100px"),$("#savepanel").css("background-color","#564F8A"),c();var a=$("#sp_graphname").val(),b=$("#sp_graphdesc").val();""!=a&&""!=b&&d(getSaveState(x,a,b,0))}),$(".edittab").click(function(a){var b=a.target||a.srcElement;$(".edittab").removeClass("active"),$(b).addClass("active"),$(b).addClass("purple"),$("#tabs-1").hide(),$("#tabs-2").hide(),$("#tabs-3").hide(),$("#tabs-4").hide(),$("#form_editnode").hide(),$(b.getAttribute("tablink")).show()}),$("#btn_export").click(function(){var a="";sys.eachNode(function(b){b.data[4]?"article"==b.data[4].val&&(a+=b.data[2].val+" Available From <"+b.data[0].val+">\n\n"):"TEXT"==b.data.TYPE&&(a+=b.data.name+" Available From <"+b.data.link+">\n\n")});var b=new Blob([a],{type:"text/plain;charset=utf-8"});saveAs(b,"reference list.txt")}),$("input").on("input",function(a){var b=a.srcElement.className;b.indexOf("add")&&(v=k()),b.indexOf("edit")&&(w=j())}),$("#btn_addedge").click(function(){o?($("#btn_addedge").removeClass("red").addClass("green"),$("#btn_addedge").val("Add Edge"),o=!1):(o=!0,$("#btn_addedge").removeClass("green").addClass("red"),$("#btn_addedge").val("cancel"))}),$("#btn_editnode").click(function(){w.easing="cubic",w.nodeid=r.nodeid,sys.tweenNode(r.nodeid,.5,w),g(r.nodeid,w,y),$("#form_editnode").hide(),$("#edit_notice").show()}),$("#btn_addnode").click(function(){if(n)$("#btn_addnode").removeClass("red").addClass("green"),$("#btn_addnode").val("Add Node"),n=!n,$("#node-dropper").remove();else if(v=k(),-1!=v){n=!0,$("#btn_addnode").removeClass("green").addClass("red"),$("#btn_addnode").val("cancel"),$("body").append('<div id="node-dropper"></div>');var a=new Object;a.w=300,a.h=70,a.title="Adding node!",a.subtext="click to place the node : ",note("#contain_main",a)}else alert("form invalid, please enter a name for the node ")})});